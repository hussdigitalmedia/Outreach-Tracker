<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Outreach Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const MessageSquare = ({ size = 20, fill = "none" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    const Plus = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const RefreshCw = ({ size = 20, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
      </svg>
    );

    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    function OutreachTracker() {
      const API_KEY = 'AIzaSyCapPzVC3LzSM2rgCyKLB1zqtNDc_3-GgU';
      const SHEET_ID = '10niFGnPOrs3wUAvoHoejXGGe0S7ALneYcrxgvplrUnM';
      
      const steps = [
        'Initial Outreach',
        'Reply',
        'First Meeting Scheduled',
        'Audit Performed',
        'First Meeting Concluded',
        'GBP Optimization Begun',
        'Profile Optimized',
        'Analytics Prepped',
        'Review Meeting',
        '1st Week of Posting',
        '1st Review Set Managed',
        'Deep Analytics Dive',
        '2nd Week of Posting',
        '2nd Review Set Managed',
        'Check-in Call',
        '3rd Week of Posting',
        '3rd Review Set Managed',
        '4th Week of Posting',
        '4th Review Set Managed',
        'Analytics Pulled',
        'Monthly Review Call'
      ];

      const [clients, setClients] = useState([]);
      const [showAddClient, setShowAddClient] = useState(false);
      const [newClientName, setNewClientName] = useState('');
      const [selectedNote, setSelectedNote] = useState(null);
      const [noteInput, setNoteInput] = useState('');
      const [editingNote, setEditingNote] = useState(null);
      const [syncing, setSyncing] = useState(false);
      const [lastSync, setLastSync] = useState(null);

      useEffect(() => {
        loadFromSheets();
      }, []);

      const loadFromSheets = async () => {
        setSyncing(true);
        try {
          const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1!A:Z?key=${API_KEY}`
          );
          const data = await response.json();
          
          if (data.values && data.values.length > 1) {
            const loadedClients = [];
            let currentClient = null;
            
            for (let i = 1; i < data.values.length; i++) {
              const row = data.values[i];
              if (row[0] && row[0].startsWith('CLIENT:')) {
                if (currentClient) {
                  loadedClients.push(currentClient);
                }
                currentClient = {
                  id: parseInt(row[1]) || Date.now() + i,
                  name: row[0].replace('CLIENT:', '').trim(),
                  progress: steps.map((step, idx) => ({
                    step,
                    completed: false,
                    note: ''
                  }))
                };
              } else if (currentClient && row[0]) {
                const stepIdx = steps.indexOf(row[0]);
                if (stepIdx !== -1) {
                  currentClient.progress[stepIdx] = {
                    step: row[0],
                    completed: row[1] === 'TRUE',
                    note: row[2] || ''
                  };
                }
              }
            }
            
            if (currentClient) {
              loadedClients.push(currentClient);
            }
            
            if (loadedClients.length > 0) {
              setClients(loadedClients);
            }
          }
          setLastSync(new Date());
        } catch (error) {
          console.error('Error loading from sheets:', error);
          alert('Could not load data from Google Sheets. Check console for details.');
        }
        setSyncing(false);
      };

      const saveToSheets = async (updatedClients) => {
        setSyncing(true);
        try {
          const rows = [['Step', 'Completed', 'Note']];
          
          updatedClients.forEach(client => {
            rows.push([`CLIENT:${client.name}`, client.id.toString(), '']);
            client.progress.forEach(item => {
              rows.push([
                item.step,
                item.completed ? 'TRUE' : 'FALSE',
                item.note || ''
              ]);
            });
            rows.push(['', '', '']);
          });

          const response = await fetch(
            `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1!A:Z?valueInputOption=RAW&key=${API_KEY}`,
            {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                values: rows
              })
            }
          );

          if (!response.ok) {
            throw new Error('Failed to save to sheets');
          }
          
          setLastSync(new Date());
        } catch (error) {
          console.error('Error saving to sheets:', error);
          alert('Could not save to Google Sheets. Check console for details.');
        }
        setSyncing(false);
      };

      const addClient = () => {
        if (newClientName.trim()) {
          const newClient = {
            id: Date.now(),
            name: newClientName,
            progress: steps.map((step) => ({
              step,
              completed: false,
              note: ''
            }))
          };
          const updatedClients = [...clients, newClient];
          setClients(updatedClients);
          saveToSheets(updatedClients);
          setNewClientName('');
          setShowAddClient(false);
        }
      };

      const toggleStep = (clientId, stepIdx) => {
        const updatedClients = clients.map(client => {
          if (client.id === clientId) {
            const newProgress = [...client.progress];
            newProgress[stepIdx].completed = !newProgress[stepIdx].completed;
            return { ...client, progress: newProgress };
          }
          return client;
        });
        setClients(updatedClients);
        saveToSheets(updatedClients);
      };

      const openNoteModal = (clientId, stepIdx) => {
        const client = clients.find(c => c.id === clientId);
        setEditingNote({ clientId, stepIdx });
        setNoteInput(client.progress[stepIdx].note);
      };

      const saveNote = () => {
        if (editingNote) {
          const updatedClients = clients.map(client => {
            if (client.id === editingNote.clientId) {
              const newProgress = [...client.progress];
              newProgress[editingNote.stepIdx].note = noteInput;
              return { ...client, progress: newProgress };
            }
            return client;
          });
          setClients(updatedClients);
          saveToSheets(updatedClients);
          setEditingNote(null);
          setNoteInput('');
        }
      };

      const viewNote = (clientId, stepIdx) => {
        const client = clients.find(c => c.id === clientId);
        setSelectedNote({
          clientName: client.name,
          step: client.progress[stepIdx].step,
          note: client.progress[stepIdx].note
        });
      };

      const deleteClient = (clientId) => {
        const updatedClients = clients.filter(c => c.id !== clientId);
        setClients(updatedClients);
        saveToSheets(updatedClients);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-orange-50 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="flex justify-between items-center mb-6">
              <div>
                <h1 className="text-3xl font-bold text-blue-900">Outreach Tracker</h1>
                {lastSync && (
                  <p className="text-xs text-gray-500 mt-1">
                    Last synced: {lastSync.toLocaleTimeString()}
                  </p>
                )}
              </div>
              <div className="flex gap-2">
                <button
                  onClick={loadFromSheets}
                  disabled={syncing}
                  className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50"
                  title="Refresh from Google Sheets"
                >
                  <RefreshCw size={20} className={syncing ? 'animate-spin' : ''} />
                </button>
                <button
                  onClick={() => setShowAddClient(true)}
                  className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                >
                  <Plus size={20} />
                  Add Client
                </button>
              </div>
            </div>

            {syncing && (
              <div className="bg-blue-100 border border-blue-300 text-blue-800 px-4 py-2 rounded-lg mb-4">
                Syncing with Google Sheets...
              </div>
            )}

            {showAddClient && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <h2 className="text-xl font-bold text-blue-900 mb-4">Add New Client</h2>
                  <input
                    type="text"
                    value={newClientName}
                    onChange={(e) => setNewClientName(e.target.value)}
                    placeholder="Client name"
                    className="w-full border-2 border-blue-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:border-orange-500"
                    onKeyPress={(e) => e.key === 'Enter' && addClient()}
                    autoFocus
                  />
                  <div className="flex gap-2">
                    <button
                      onClick={addClient}
                      className="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors"
                    >
                      Add
                    </button>
                    <button
                      onClick={() => {
                        setShowAddClient(false);
                        setNewClientName('');
                      }}
                      className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg transition-colors"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}

            {editingNote && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <h2 className="text-xl font-bold text-blue-900 mb-4">Add Note</h2>
                  <textarea
                    value={noteInput}
                    onChange={(e) => setNoteInput(e.target.value)}
                    placeholder="Enter your note..."
                    className="w-full border-2 border-blue-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:border-orange-500 min-h-32"
                    autoFocus
                  />
                  <div className="flex gap-2">
                    <button
                      onClick={saveNote}
                      className="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors"
                    >
                      Save
                    </button>
                    <button
                      onClick={() => {
                        setEditingNote(null);
                        setNoteInput('');
                      }}
                      className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg transition-colors"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            )}

            {selectedNote && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <h2 className="text-xl font-bold text-blue-900">{selectedNote.clientName}</h2>
                      <p className="text-sm text-gray-600">{selectedNote.step}</p>
                    </div>
                    <button
                      onClick={() => setSelectedNote(null)}
                      className="text-gray-500 hover:text-gray-700"
                    >
                      <X size={24} />
                    </button>
                  </div>
                  <p className="text-gray-800 whitespace-pre-wrap">{selectedNote.note}</p>
                </div>
              </div>
            )}

            <div className="space-y-6">
              {clients.length === 0 && !syncing && (
                <div className="text-center py-12 text-gray-500">
                  <p className="text-lg">No clients yet. Click "Add Client" to get started!</p>
                </div>
              )}

              {clients.map(client => (
                <div key={client.id} className="bg-white rounded-lg shadow-lg p-4">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold text-blue-900">{client.name}</h2>
                    <button
                      onClick={() => deleteClient(client.id)}
                      className="text-red-500 hover:text-red-700 text-sm"
                    >
                      Delete
                    </button>
                  </div>
                  <div className="overflow-x-auto">
                    <div className="flex gap-3 pb-2" style={{ minWidth: 'max-content' }}>
                      {client.progress.map((item, idx) => (
                        <div key={idx} className="flex flex-col items-center">
                          <button
                            onClick={() => toggleStep(client.id, idx)}
                            className={`w-32 h-20 rounded-lg border-2 transition-all flex items-center justify-center text-xs font-medium p-2 text-center ${
                              item.completed
                                ? 'bg-green-500 border-green-600 text-white'
                                : 'bg-blue-100 border-blue-300 text-blue-900 hover:bg-blue-200'
                            }`}
                          >
                            {item.step}
                          </button>
                          <div className="flex gap-1 mt-2">
                            {item.note && (
                              <button
                                onClick={() => viewNote(client.id, idx)}
                                className="text-orange-500 hover:text-orange-700"
                                title="View note"
                              >
                                <MessageSquare size={16} fill="currentColor" />
                              </button>
                            )}
                            <button
                              onClick={() => openNoteModal(client.id, idx)}
                              className="text-blue-500 hover:text-blue-700"
                              title="Add/edit note"
                            >
                              <MessageSquare size={16} />
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<OutreachTracker />);
  </script>
</body>
</html>